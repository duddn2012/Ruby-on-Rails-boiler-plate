# 🎨 MCP 서버 테스트 가이드

## 📋 개요

이 가이드는 "내 화장품을 찾아줘!" MCP 서버를 테스트하는 방법을 설명합니다.

## 🚀 테스트 준비

### 1단계: 데이터베이스 설정

```bash
# 마이그레이션 실행
rails db:migrate

# 시드 데이터 생성
rails db:seed
```

### 2단계: Rails 서버 실행

```bash
# 새 터미널에서 Rails 서버 실행
rails server
```

### 3단계: MCP 서버 테스트

#### 방법 1: 빠른 테스트 (자동)

```bash
ruby bin/quick_test.rb
```

#### 방법 2: 대화형 테스트 (수동)

```bash
ruby bin/test_mcp_interactive.rb
```

#### 방법 3: 기본 테스트

```bash
ruby bin/mcp_server --test
```

## 🧪 테스트 시나리오

### 시나리오 1: 사용자 등록 및 추천

1. **사용자 등록**

   - 피부 타입: combination (복합성)
   - 고민사항: acne,hydration
   - 연령대: twenties (20대)

2. **추천 생성**
   - 등록된 사용자 ID로 추천 생성
   - AI 알고리즘에 따른 개인화된 추천 확인

### 시나리오 2: 제품 검색

1. **일반 검색**

   - 검색어: "moisturizer"
   - 결과: 보습 제품들

2. **필터링 검색**
   - 검색어: "serum"
   - 카테고리: "serum"
   - 최대 가격: 50000

### 시나리오 3: 성분 검색

1. **성분 검색**

   - 검색어: "hyaluronic"
   - 결과: 하이알루론산 관련 성분들

2. **효과별 필터링**
   - 검색어: "vitamin"
   - 효과: "aging"

### 시나리오 4: 성분별 제품 검색

1. **특정 성분 포함 제품**

   - 성분명: "hyaluronic_acid"
   - 결과: 하이알루론산이 포함된 제품들

2. **개인화된 성분별 추천**
   - 성분명: "retinol"
   - 사용자 ID: 1
   - 결과: 사용자 맞춤형 레티놀 제품 추천

## 📊 예상 결과

### 성공적인 테스트 결과

```
🎨 MCP 서버 빠른 테스트
==============================

1️⃣ 사용자 등록 테스트
✅ 사용자 등록 성공

2️⃣ 제품 검색 테스트
✅ 제품 검색 성공 (15개 제품)

3️⃣ 성분 검색 테스트
✅ 성분 검색 성공 (13개 성분)

4️⃣ 추천 생성 테스트
✅ 추천 생성 성공 (20개 추천)

5️⃣ 성분별 제품 검색 테스트
✅ 성분별 제품 검색 성공 (3개 제품)

6️⃣ 사용자 프로필 조회 테스트
✅ 프로필 조회 성공

==============================
📊 테스트 결과 요약:
  사용자 등록: 성공 (ID: 6)
  제품 검색: 성공
  성분 검색: 성공
  추천 생성: 성공
  성분별 제품 검색: 성공
  프로필 조회: 성공

🎯 성공률: 6/6 (100.0%)
🎉 모든 테스트가 성공했습니다!
```

## 🔧 문제 해결

### 일반적인 오류들

#### 1. "서버 오류" 메시지

**원인**: Rails 서버가 실행되지 않음
**해결**: `rails server` 실행

#### 2. "사용자를 찾을 수 없습니다"

**원인**: 시드 데이터가 생성되지 않음
**해결**: `rails db:seed` 실행

#### 3. "데이터베이스 연결 오류"

**원인**: 데이터베이스가 생성되지 않음
**해결**: `rails db:create && rails db:migrate` 실행

#### 4. "마이그레이션 오류"

**원인**: 마이그레이션 파일 충돌
**해결**:

```bash
rails db:reset
# 또는
rails db:drop && rails db:create && rails db:migrate
```

### 디버깅 팁

1. **Rails 서버 로그 확인**

   ```bash
   # Rails 서버 실행 중 로그 확인
   tail -f log/development.log
   ```

2. **데이터베이스 상태 확인**

   ```bash
   rails console
   > User.count
   > Product.count
   > Ingredient.count
   ```

3. **API 직접 테스트**
   ```bash
   # 사용자 등록 테스트
   curl -X POST http://localhost:3000/api/users \
     -H "Content-Type: application/json" \
     -d '{"user":{"skin_type":"combination","concerns":"acne,hydration","age_group":"twenties"}}'
   ```

## 📝 테스트 체크리스트

- [ ] Rails 서버가 실행 중인가?
- [ ] 데이터베이스 마이그레이션이 완료되었는가?
- [ ] 시드 데이터가 생성되었는가?
- [ ] 모든 모델이 올바르게 정의되었는가?
- [ ] API 컨트롤러가 구현되었는가?
- [ ] MCP 서버가 올바르게 설정되었는가?

## 🎯 성공 기준

### 최소 성공 기준

- ✅ 사용자 등록/조회
- ✅ 제품 검색
- ✅ 성분 검색
- ✅ 기본 추천 생성

### 완전 성공 기준

- ✅ 모든 MCP 도구 정상 작동
- ✅ 개인화된 추천 알고리즘 작동
- ✅ 성분별 제품 검색
- ✅ 필터링 및 정렬 기능
- ✅ 오류 처리 및 응답

## 🚀 다음 단계

테스트가 성공적으로 완료되면:

1. **API 문서화** - Swagger/OpenAPI 문서 생성
2. **성능 최적화** - 캐싱, 인덱싱 적용
3. **보안 강화** - 인증/인가 구현
4. **배포 준비** - Heroku/Docker 설정
5. **모니터링** - 로깅 및 메트릭 설정

## 📞 지원

문제가 발생하면:

1. Rails 서버 로그 확인
2. 데이터베이스 상태 확인
3. API 직접 테스트
4. MCP 서버 설정 재확인
